<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Voting System</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
    integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
  <script>
    if (window.history.replaceState) {
      window.history.replaceState(null, null, window.location.href);
    }
  </script>
</head>

<body class="bg-light text-dark">
  <div class="container shadow-sm p-3 mb-5 bg-white rounded">
    <h3 class="text-center p-3">ELECTRONIC VOTING</h3>
    <form id="register-form">
      <div>
        <p class=" bg-warning p-2 text-center">REGISTER</p>
      </div>
      <hr>
      <div class="row">
        <div class="col-lg-12">Server Status: <span id="serverStatus">Not connected </span></div>
      </div>
      <hr>

      <div class="mb-3 mt-3">

        <label for="name" class="form-label"> Full Name</label>
        <input type="text" class="form-control" id="name" placeholder="Enter Full Name" name="name" required>
      </div>
      <fieldset class="row mb-3">
        <legend class="col-form-label col-sm-2 pt-0">Gender</legend>
        <div class="col-sm-10">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="gender" id="gridRadios1" value="Male" checked>
            <label class="form-check-label" for="gridRadios1">
              Male
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="gender" id="gridRadios2" value="Female">
            <label class="form-check-label" for="gridRadios2">
              Female
            </label>
          </div>

        </div>
      </fieldset>
      <div class="mb-3 mt-3">
        <label for="voteid" class="form-label"> Vote ID</label>
        <input type="text" class="form-control" id="voteId" placeholder="Enter vote ID" name="voteID" required>
      </div>
      <div class="mb-3 mt-3">
        <label for="phone" class="form-label">Phone:</label>
        <input type="phone" class="form-control" id="phone" placeholder="Enter phone" name="phone">
      </div>

      <div class="mb-3 mt-3 p-3 bg-primary">
        <h4 class="p-3 text-light">Finger Print Verification</h4>
        <label for="fingerId" class="form-label text-light">Enter Finger ID:</label>
        <input type="number" class="form-control" placeholder="Enter id (1-127)" name="input_Id" id="input_Id" required>
        <p><button class="btn-success text-light mt-2 " type="button" id="sendId">Send</button></p>
        <div class="row">
          <div class="col-lg-4 "></div>
          <div class="col-lg-4 p-3  bg-danger text-light">
            <h3 id="placeFinger">No Finger Detected</h3>
          </div>
          <div class="col-lg-4 "></div>
        </div>
      </div>
      <button type="button" class="btn btn-primary" id="submit-btn">Register</button>

    </form>

  </div>

  <script>
    var socket = new WebSocket('ws:localhost:5555/ws');
    var server_status = document.getElementById('serverStatus');
    var finger_status = document.getElementById('finger-print-status');
    var sendId = document.getElementById('sendId');
    var finger_Id = document.getElementById('input_Id');
    socket.onopen = function () {
      console.log('Connected to server');
      $('#serverStatus').html('Server Connected');
    };
    socket.onmessage = function (event) {
      var data = JSON.parse(event.data);
      var res = data.command;
      res = res.replace(/\s/g, '');
      var message = ``;
      $('#placeFinger').html(message);
     
    }

    sendId.addEventListener('click', function () {
        $('#sendId').prop('disabled', true);
      socket.send("e");
      $('#placeFinger').html("wait..");
      });



    $('#submit-btn').click(function (e) {
      e.preventDefault();
      var name = $("#name").val();
      var genders = document.getElementsByName('gender');
      var phone = $("#phone").val();
      var voteId = $("#voteId").val();
      var gender = '';
      var fingerId = $("#input_Id").val();
      var faceId = "";
      for (var i = 0, length = genders.length; i < length; i++) {
        if (genders[i].checked) {
          gender = genders[i].value;
          break;
        }
      }
      if (name === "") {
        alert('Provide Voters Name');
        return;
      }
      $.ajax({
        type: "POST",
        url: "actionpages/registration.php",
        data: {
          name: name,
          gender: gender,
          voteId: voteId,
          phone: phone,
          fingerId: fingerId,
          faceId: faceId
        },
        cache: false,
        success: function (data) {
          alert(data);
          if (data == "success") {
            $('#register-form').trigger("reset");
          } else {
            $("#error").show();
            $('#error').html('Error Occured');
          }
        },
        error: function (xhr, status, error) {
          // alert(error);
        }
      });
    });

    socket.onclose = function () {
      console.log('Network Disconneted');
      $('#serverStatus').html('Server Disconneted');
    };

  </script>
</body>

</html>